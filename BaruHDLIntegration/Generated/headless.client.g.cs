// <auto-generated>
//     Generated by ProtoPocoGen. Do not edit.
// </auto-generated>

#nullable enable

using System;
using System.Net.Http;
using System.Text;
using System.Text.Json;
using System.Text.Json.Serialization;
using System.Threading;
using System.Threading.Tasks;

namespace Headless.Rpc;

/// <summary>
/// Auto-generated client for HeadlessControlService
/// </summary>
public class HeadlessControlServiceClient
{
    public const string ServiceName = "headless.v1.HeadlessControlService";

    protected readonly HttpClient _httpClient;
    protected readonly string _baseAddress;
    protected readonly JsonSerializerOptions _jsonOptions;

    public HeadlessControlServiceClient(HttpClient httpClient, string baseAddress, JsonSerializerOptions? jsonOptions = null)
    {
        _httpClient = httpClient;
        _baseAddress = baseAddress.TrimEnd('/');
        _jsonOptions = jsonOptions ?? CreateDefaultJsonOptions();
    }

    private static JsonSerializerOptions CreateDefaultJsonOptions() => new()
    {
        PropertyNamingPolicy = JsonNamingPolicy.CamelCase,
        DefaultIgnoreCondition = JsonIgnoreCondition.WhenWritingNull
    };

    /// <summary>
    /// Called before sending a request. Override to add authentication headers, etc.
    /// </summary>
    protected virtual void ConfigureRequest(HttpRequestMessage request) { }

    /// <summary>
    /// Called when a request fails. Return true to retry the request.
    /// </summary>
    /// <param name="response">The failed response</param>
    /// <param name="retryCount">Current retry count (starts at 0)</param>
    /// <param name="cancellationToken">Cancellation token</param>
    /// <returns>True to retry, false to throw</returns>
    protected virtual Task<bool> OnRequestFailedAsync(
        HttpResponseMessage response,
        int retryCount,
        CancellationToken cancellationToken)
    {
        return Task.FromResult(false);
    }

    protected virtual async Task<TResponse> RequestAsync<TRequest, TResponse>(
        string rpcName,
        TRequest request,
        CancellationToken cancellationToken = default)
    {
        var retryCount = 0;
        while (true)
        {
            var json = JsonSerializer.Serialize(request, _jsonOptions);
            var httpRequest = new HttpRequestMessage(HttpMethod.Post,
                $"{_baseAddress}/{ServiceName}/{rpcName}");
            httpRequest.Content = new StringContent(json, Encoding.UTF8, "application/json");

            ConfigureRequest(httpRequest);

            var response = await _httpClient.SendAsync(httpRequest, cancellationToken);

            if (!response.IsSuccessStatusCode)
            {
                if (await OnRequestFailedAsync(response, retryCount, cancellationToken))
                {
                    retryCount++;
                    continue;
                }
            }

            response.EnsureSuccessStatusCode();

            var responseJson = await response.Content.ReadAsStringAsync(cancellationToken);
            return JsonSerializer.Deserialize<TResponse>(responseJson, _jsonOptions)!;
        }
    }

    public virtual Task<GetAboutResponse> GetAboutAsync(
        GetAboutRequest request,
        CancellationToken cancellationToken = default)
    {
        return RequestAsync<GetAboutRequest, GetAboutResponse>(
            "GetAbout", request, cancellationToken);
    }

    public virtual Task<GetStatusResponse> GetStatusAsync(
        GetStatusRequest request,
        CancellationToken cancellationToken = default)
    {
        return RequestAsync<GetStatusRequest, GetStatusResponse>(
            "GetStatus", request, cancellationToken);
    }

    public virtual Task<ShutdownResponse> ShutdownAsync(
        ShutdownRequest request,
        CancellationToken cancellationToken = default)
    {
        return RequestAsync<ShutdownRequest, ShutdownResponse>(
            "Shutdown", request, cancellationToken);
    }

    public virtual Task<ListSessionsResponse> ListSessionsAsync(
        ListSessionsRequest request,
        CancellationToken cancellationToken = default)
    {
        return RequestAsync<ListSessionsRequest, ListSessionsResponse>(
            "ListSessions", request, cancellationToken);
    }

    public virtual Task<GetSessionResponse> GetSessionAsync(
        GetSessionRequest request,
        CancellationToken cancellationToken = default)
    {
        return RequestAsync<GetSessionRequest, GetSessionResponse>(
            "GetSession", request, cancellationToken);
    }

    public virtual Task<StartWorldResponse> StartWorldAsync(
        StartWorldRequest request,
        CancellationToken cancellationToken = default)
    {
        return RequestAsync<StartWorldRequest, StartWorldResponse>(
            "StartWorld", request, cancellationToken);
    }

    public virtual Task<StopSessionResponse> StopSessionAsync(
        StopSessionRequest request,
        CancellationToken cancellationToken = default)
    {
        return RequestAsync<StopSessionRequest, StopSessionResponse>(
            "StopSession", request, cancellationToken);
    }

    public virtual Task<SaveSessionWorldResponse> SaveSessionWorldAsync(
        SaveSessionWorldRequest request,
        CancellationToken cancellationToken = default)
    {
        return RequestAsync<SaveSessionWorldRequest, SaveSessionWorldResponse>(
            "SaveSessionWorld", request, cancellationToken);
    }

    public virtual Task<SaveAsSessionWorldResponse> SaveAsSessionWorldAsync(
        SaveAsSessionWorldRequest request,
        CancellationToken cancellationToken = default)
    {
        return RequestAsync<SaveAsSessionWorldRequest, SaveAsSessionWorldResponse>(
            "SaveAsSessionWorld", request, cancellationToken);
    }

    public virtual Task<InviteUserResponse> InviteUserAsync(
        InviteUserRequest request,
        CancellationToken cancellationToken = default)
    {
        return RequestAsync<InviteUserRequest, InviteUserResponse>(
            "InviteUser", request, cancellationToken);
    }

    public virtual Task<AllowUserToJoinResponse> AllowUserToJoinAsync(
        AllowUserToJoinRequest request,
        CancellationToken cancellationToken = default)
    {
        return RequestAsync<AllowUserToJoinRequest, AllowUserToJoinResponse>(
            "AllowUserToJoin", request, cancellationToken);
    }

    public virtual Task<UpdateUserRoleResponse> UpdateUserRoleAsync(
        UpdateUserRoleRequest request,
        CancellationToken cancellationToken = default)
    {
        return RequestAsync<UpdateUserRoleRequest, UpdateUserRoleResponse>(
            "UpdateUserRole", request, cancellationToken);
    }

    public virtual Task<UpdateSessionParametersResponse> UpdateSessionParametersAsync(
        UpdateSessionParametersRequest request,
        CancellationToken cancellationToken = default)
    {
        return RequestAsync<UpdateSessionParametersRequest, UpdateSessionParametersResponse>(
            "UpdateSessionParameters", request, cancellationToken);
    }

    public virtual Task<ListUsersInSessionResponse> ListUsersInSessionAsync(
        ListUsersInSessionRequest request,
        CancellationToken cancellationToken = default)
    {
        return RequestAsync<ListUsersInSessionRequest, ListUsersInSessionResponse>(
            "ListUsersInSession", request, cancellationToken);
    }

    public virtual Task<KickUserResponse> KickUserAsync(
        KickUserRequest request,
        CancellationToken cancellationToken = default)
    {
        return RequestAsync<KickUserRequest, KickUserResponse>(
            "KickUser", request, cancellationToken);
    }

    public virtual Task<BanUserResponse> BanUserAsync(
        BanUserRequest request,
        CancellationToken cancellationToken = default)
    {
        return RequestAsync<BanUserRequest, BanUserResponse>(
            "BanUser", request, cancellationToken);
    }

    public virtual Task<GetHostSettingsResponse> GetHostSettingsAsync(
        GetHostSettingsRequest request,
        CancellationToken cancellationToken = default)
    {
        return RequestAsync<GetHostSettingsRequest, GetHostSettingsResponse>(
            "GetHostSettings", request, cancellationToken);
    }

    public virtual Task<UpdateHostSettingsResponse> UpdateHostSettingsAsync(
        UpdateHostSettingsRequest request,
        CancellationToken cancellationToken = default)
    {
        return RequestAsync<UpdateHostSettingsRequest, UpdateHostSettingsResponse>(
            "UpdateHostSettings", request, cancellationToken);
    }

    public virtual Task<AllowHostAccessResponse> AllowHostAccessAsync(
        AllowHostAccessRequest request,
        CancellationToken cancellationToken = default)
    {
        return RequestAsync<AllowHostAccessRequest, AllowHostAccessResponse>(
            "AllowHostAccess", request, cancellationToken);
    }

    public virtual Task<DenyHostAccessResponse> DenyHostAccessAsync(
        DenyHostAccessRequest request,
        CancellationToken cancellationToken = default)
    {
        return RequestAsync<DenyHostAccessRequest, DenyHostAccessResponse>(
            "DenyHostAccess", request, cancellationToken);
    }

    public virtual Task<GetStartupConfigToRestoreResponse> GetStartupConfigToRestoreAsync(
        GetStartupConfigToRestoreRequest request,
        CancellationToken cancellationToken = default)
    {
        return RequestAsync<GetStartupConfigToRestoreRequest, GetStartupConfigToRestoreResponse>(
            "GetStartupConfigToRestore", request, cancellationToken);
    }

    public virtual Task<GetAccountInfoResponse> GetAccountInfoAsync(
        GetAccountInfoRequest request,
        CancellationToken cancellationToken = default)
    {
        return RequestAsync<GetAccountInfoRequest, GetAccountInfoResponse>(
            "GetAccountInfo", request, cancellationToken);
    }

    public virtual Task<FetchWorldInfoResponse> FetchWorldInfoAsync(
        FetchWorldInfoRequest request,
        CancellationToken cancellationToken = default)
    {
        return RequestAsync<FetchWorldInfoRequest, FetchWorldInfoResponse>(
            "FetchWorldInfo", request, cancellationToken);
    }

    public virtual Task<SearchUserInfoResponse> SearchUserInfoAsync(
        SearchUserInfoRequest request,
        CancellationToken cancellationToken = default)
    {
        return RequestAsync<SearchUserInfoRequest, SearchUserInfoResponse>(
            "SearchUserInfo", request, cancellationToken);
    }

    public virtual Task<GetFriendRequestsResponse> GetFriendRequestsAsync(
        GetFriendRequestsRequest request,
        CancellationToken cancellationToken = default)
    {
        return RequestAsync<GetFriendRequestsRequest, GetFriendRequestsResponse>(
            "GetFriendRequests", request, cancellationToken);
    }

    public virtual Task<AcceptFriendRequestsResponse> AcceptFriendRequestsAsync(
        AcceptFriendRequestsRequest request,
        CancellationToken cancellationToken = default)
    {
        return RequestAsync<AcceptFriendRequestsRequest, AcceptFriendRequestsResponse>(
            "AcceptFriendRequests", request, cancellationToken);
    }

    public virtual Task<ListContactsResponse> ListContactsAsync(
        ListContactsRequest request,
        CancellationToken cancellationToken = default)
    {
        return RequestAsync<ListContactsRequest, ListContactsResponse>(
            "ListContacts", request, cancellationToken);
    }

    public virtual Task<GetContactMessagesResponse> GetContactMessagesAsync(
        GetContactMessagesRequest request,
        CancellationToken cancellationToken = default)
    {
        return RequestAsync<GetContactMessagesRequest, GetContactMessagesResponse>(
            "GetContactMessages", request, cancellationToken);
    }

    public virtual Task<SendContactMessageResponse> SendContactMessageAsync(
        SendContactMessageRequest request,
        CancellationToken cancellationToken = default)
    {
        return RequestAsync<SendContactMessageRequest, SendContactMessageResponse>(
            "SendContactMessage", request, cancellationToken);
    }

}

